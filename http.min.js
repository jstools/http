/*! jstool-http 2015-03-10 */
!function(a){"use strict";"undefined"!=typeof window&&(window.fn?fn.define("http",a):window.http||(window.http=a()))}(function(){"use strict";function a(){for(var b,c=[],d=c.shift.call(arguments),e=c.shift.call(arguments);e;){for(b in e)d[b]=d[b]instanceof Object&&e[b]instanceof Object?a({},e[b]):e[b];e=c.shift.call(arguments)}return d}function b(a,c,d){if(a){if(c=c||"",d=d||0,a instanceof Function)return(d?"&":"")+encodeURIComponent(c)+"="+encodeURIComponent(a());if(a instanceof Object){var e="";for(var f in a)e+=b(a[f],(c?c+".":"")+f,d++);return e}return(d?"&":"")+encodeURIComponent(c)+"="+encodeURIComponent(a)}return""}function c(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function d(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function e(a,b,c,d){var f=b.shift(),g=void 0;if(f||(f=b.$finally.shift()),f instanceof Function)f(c,a.status,a);else if(f instanceof Object&&(d&&f.resolve&&(g=f.resolve(c,a.status,a)),!d&&f.reject&&(g=f.reject(c,a.status,a)),g&&g.then)){if(b.forEach(function(a){g.then(a.resolve,a.reject)}),g.finally)b.$finally.forEach(function(a){g.finally(a.resolve,a.reject)});else if(b.$finally.length)throw"received promise not implements finally";f=!1}f&&e(a,b,void 0===g?c:g,d)}function f(a,b,c){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(b,c,e){a.headers[d(c)]=e.trim()});var f=a.responseText;"application/json"===a.headers.contentType?f=JSON.parse(f):"application/xml"===a.headers.contentType&&(f=(new DOMParser).parseFromString(f,"text/xml")),c[a.status]?c[a.status].apply(a,[f,function(c){e(a,b,c,!0)},function(c){e(a,b,c,!0)}]):a.status>=200&&a.status<300?(a.$resolved=!0,e(a,b,f,!0)):e(a,b,f,!1)}function g(a){this.url=a}function h(d,e){if(d instanceof Object&&(e=d,d=e.url),void 0===e)return new g(d);var i,j=a({},h.defaults),k={},l=[];for(i in e)e[i]instanceof Function&&(e[i]=e[i]()),j[i]instanceof Function&&(j[i]=j[i]()),"data"!==i&&e[i]instanceof Object?a(j[i],e[i]):j[i]=e[i];if(!d)throw"url missing";/^get$/.test(j.method)&&j.data instanceof Object&&Object.keys(j.data).length&&(console.log("options.data",j.data),d+="?"+b(j.data),j.data=null);var m=null;try{m=new XMLHttpRequest}catch(n){try{m=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){m=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===m)throw"Browser does not support HTTP Request";m.open(j.method.toUpperCase(),d,void 0===j.async?!0:j.async);for(i in j.headers)m.setRequestHeader(c(i),j.headers[i]);return m.onreadystatechange=function(){("complete"===m.readyState||4===m.readyState)&&f(m,l,k)},void 0!==j.data&&"string"!=typeof j.data&&(j.data=JSON.stringify(j.data)),m.send(j.data),m.then=function(a,b){return a instanceof Function&&l.push({resolve:a,reject:b}),m},m.catch=function(a){return a instanceof Function&&l.push({resolve:null,reject:a}),m},l.$finally=[],m.finally=function(a){return l.$finally.push(a),m},m}return["get","head","options","post","put","delete","patch"].forEach(function(a){g.prototype[a]=function(){var b=[this.url];return[].push.apply(b,arguments),h[a].apply(null,b)}}),h.defaults={method:"get",headers:{contentType:"application/json"}},["get","head","options","post","put","delete"].forEach(function(a){h[a]=function(b,c,d){return b instanceof Object&&(d=b,b=d.url),d=d||{},d.data=c,d.method=a,h(b,d)}}),h.patch=function(b,c,d){if(b instanceof Object)return b.method="patch",h(b);if("string"==typeof b){if(d=d instanceof Object?d:{},c)return h(b,a(d,{method:"patch",data:c}));var e=[],f=function(a){return e.push(a),g},g={add:function(a,b){return f({op:"add",path:a,value:b})},test:function(a,b){return f({op:"test",path:a,value:b})},replace:function(a,b){return f({op:"replace",path:a,value:b})},move:function(a,b){return f({op:"move",from:a,path:b})},copy:function(a,b){return f({op:"copy",from:a,path:b})},remove:function(a){return f({op:"remove",path:a})},flush:function(){return e.splice(0,e.length),g},submit:function(c){return c=c||e,h(b,a(d,{method:"patch",data:c}))}};return g}},h});