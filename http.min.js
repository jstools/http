/*! jstool-http 2015-03-06 */
!function(a){"use strict";"undefined"!=typeof window&&(window.fn?fn.define("http",a):window.http||(window.http=a()))}(function(){"use strict";function a(){for(var b,c=[],d=c.shift.call(arguments),e=c.shift.call(arguments);e;){for(b in e)d[b]=d[b]instanceof Object&&e[b]instanceof Object?a({},e[b]):e[b];e=c.shift.call(arguments)}return d}function b(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function c(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function d(a,b,c,e){var f=b.shift(),g=void 0;if(f||(f=b.$finally.shift()),f instanceof Function)f(c,a.status,a);else if(f instanceof Object&&(e&&f.resolve&&(g=f.resolve(c,a.status,a)),!e&&f.reject&&(g=f.reject(c,a.status,a)),g&&g.then)){if(b.forEach(function(a){g.then(a.resolve,a.reject)}),g.finally)b.$finally.forEach(function(a){g.finally(a.resolve,a.reject)});else if(b.$finally.length)throw"received promise not implements finally";f=!1}f&&d(a,b,void 0===g?c:g,e)}function e(a,b,e){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(b,d,e){a.headers[c(d)]=e.trim()});var f=a.responseText;"application/json"===a.headers.contentType&&(f=JSON.parse(f)),e[a.status]?e[a.status].apply(a,[f,function(c){d(a,b,c,!0)},function(c){d(a,b,c,!0)}]):a.status>=200&&a.status<300?(a.$resolved=!0,d(a,b,f,!0)):d(a,b,f,!1)}function f(a){this.url=a}function g(c,d){if(c instanceof Object&&(d=c,c=d.url),!d)return new f(c);var h,i=a({},g.defaults),j={},k=[];for(h in d)d[h]instanceof Function&&(d[h]=d[h]()),i[h]instanceof Function&&(i[h]=i[h]()),"data"!==h&&d[h]instanceof Object?a(i[h],d[h]):i[h]=d[h];if(!c)throw"url missing";var l=null;try{l=new XMLHttpRequest}catch(m){try{l=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){l=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===l)throw"Browser does not support HTTP Request";l.open(i.method.toUpperCase(),c,void 0===i.async?!0:i.async);for(h in i.headers)l.setRequestHeader(b(h),i.headers[h]);return l.onreadystatechange=function(){("complete"===l.readyState||4===l.readyState)&&e(l,k,j)},void 0!==i.data&&"string"!=typeof i.data&&(i.data=JSON.stringify(i.data)),l.send(i.data),l.then=function(a,b){return a instanceof Function&&k.push({resolve:a,reject:b}),l},l.catch=function(a){return a instanceof Function&&k.push({resolve:null,reject:a}),l},k.$finally=[],l.finally=function(a){return k.$finally.push(a),l},l}return["head","options","post","put","delete","patch"].forEach(function(a){f.prototype[a]=function(){var b=[this.url];return[].push.apply(b,arguments),g[a].apply(null,b)}}),g.defaults={method:"get",headers:{contentType:"application/json"}},g.get=g,["head","options","post","put","delete"].forEach(function(a){g[a]=function(b,c,d){return b instanceof Object&&(d=b,b=d.url),d=d||{},d.data=c,d.method=a,g(b,d)}}),g.patch=function(b,c,d){if(b instanceof Object)return b.method="patch",g(b);if("string"==typeof b){if(d=d instanceof Object?d:{},c)return g(b,a(d,{method:"patch",data:c}));var e=[],f=function(a){return e.push(a),h},h={add:function(a,b){return f({op:"add",path:a,value:b})},test:function(a,b){return f({op:"test",path:a,value:b})},replace:function(a,b){return f({op:"replace",path:a,value:b})},move:function(a,b){return f({op:"move",from:a,path:b})},copy:function(a,b){return f({op:"copy",from:a,path:b})},remove:function(a){return f({op:"remove",path:a})},flush:function(){return e.splice(0,e.length),h},submit:function(c){return c=c||e,g(b,a(d,{method:"patch",data:c}))}};return h}},g});