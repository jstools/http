/*! jstool-http 2015-02-28 */
!function(a){"use strict";"undefined"!=typeof window&&(window.fn?fn.define("http",a):window.http||(window.http=a()))}(function(){"use strict";function a(){for(var b,c=[],d=c.shift.call(arguments),e=c.shift.call(arguments);e;){for(b in e)d[b]=d[b]instanceof Object&&e[b]instanceof Object?a({},e[b]):e[b];e=c.shift.call(arguments)}return d}function b(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function c(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function d(a,b,c,e){var f=b.shift(),g=void 0;if(f||(f=b.$finally.shift()),f instanceof Function)f(c,a.status,a);else if(f instanceof Object&&(e&&f.resolve&&(g=f.resolve(c,a.status,a)),!e&&f.reject&&(g=f.reject(c,a.status,a)),g&&g.then)){if(b.forEach(function(a){g.then(a.resolve,a.reject)}),g.finally)b.$finally.forEach(function(a){g.finally(a.resolve,a.reject)});else if(b.$finally.length)throw"received promise not implements finally";f=!1}f&&d(a,b,void 0===g?c:g,e)}function e(a,b,e){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(b,d,e){a.headers[c(d)]=e.trim()});var f=a.responseText;"application/json"===a.headers.contentType&&(f=JSON.parse(f)),e[a.status]?e[a.status].apply(a,[f,function(c){d(a,b,c,!0)},function(c){d(a,b,c,!0)}]):a.status>=200&&a.status<300?(a.$resolved=!0,d(a,b,f,!0)):d(a,b,f,!1)}function f(c,d){c instanceof Object&&(d=c,c=d.url),d=d||{};var g,h=a({},f.defaults),i={},j=[];for(g in d)d[g]instanceof Function&&(d[g]=d[g]()),h[g]instanceof Function&&(h[g]=h[g]()),"data"!==g&&d[g]instanceof Object?a(h[g],d[g]):h[g]=d[g];if(!c)throw"url missing";var k=null;try{k=new XMLHttpRequest}catch(l){try{k=new ActiveXObject("Msxml2.XMLHTTP")}catch(l){k=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===k)throw"Browser does not support HTTP Request";k.open(h.method.toUpperCase(),c,void 0===h.async?!0:h.async);for(g in h.headers)k.setRequestHeader(b(g),h.headers[g]);return k.onreadystatechange=function(){("complete"===k.readyState||4===k.readyState)&&e(k,j,i)},void 0!==h.data&&"string"!=typeof h.data&&(h.data=JSON.stringify(h.data)),k.send(h.data),k.then=function(a,b){return a instanceof Function&&j.push({resolve:a,reject:b}),k},k.catch=function(a){return a instanceof Function&&j.push({resolve:null,reject:a}),k},j.$finally=[],k.finally=function(a){return j.$finally.push(a),k},k}return f.defaults={method:"get",headers:{contentType:"application/json"}},f.get=f,["head","options","post","put","delete"].forEach(function(a){f[a]=function(a,b,c){return a instanceof Object&&(c=a,a=c.url),c=c||{},c.data=b,f(a,c)}}),f.patch=function(b,c,d){if(b instanceof Object)return b.method="patch",f(b);if("string"==typeof b){if(d=d instanceof Object?d:{},c)return f(b,a(d,{method:"patch",data:c}));var e=[],g=function(a){return e.push(a),h},h={add:function(a,b){return g({op:"add",path:a,value:b})},test:function(a,b){return g({op:"test",path:a,value:b})},replace:function(a,b){return g({op:"replace",path:a,value:b})},move:function(a,b){return g({op:"move",from:a,path:b})},copy:function(a,b){return g({op:"copy",from:a,path:b})},remove:function(a){return g({op:"remove",path:a})},flush:function(){return e.splice(0,e.length),h},submit:function(c){return c=c||e,f(b,a(d,{method:"patch",data:c}))}};return h}},f});