/*! jengine-http 2015-05-27 */
!function(a,b){"use strict";if("undefined"!=typeof a)if(a.define)define("$http",b);else if(a.angular){var c=b();angular.module("jstools.http",[]).provider(function(){this.config=function(a){a.call(null,c)},this.$get=function(){return c}})}else a.$http||(a.$http=b())}(this,function(){"use strict";function a(a){return function(b){return typeof b===a}}function b(a){return function(b){return b instanceof a}}function c(a){if(o(a)){for(var b=[],d=0,e=a.length;e>d;d++)b[d]=c(a[d]);return b}if(n(a)){var f={};for(var g in a)f[g]=c(a[g]);return f}return a}function d(){for(var a,b=[],d=b.shift.call(arguments),e=b.shift.call(arguments);e;){for(a in e)d[a]=n(d[a])&&n(e[a])?c(e[a]):e[a];e=b.shift.call(arguments)}return d}function e(a){for(var b in a)p(a[b])?a[b]=a[b]():n(a[b])&&e(a[b]);return a}function f(){for(var a=(arguments[0]||"").replace(/\/$/,""),b=1,c=arguments.length-1;c>b;b++)a+="/"+arguments[c].replace(/^\/|\/$/,"");return c&&(a+=arguments[c]?"/"+arguments[c].replace(/^\//,""):""),a}function g(a,b,c){if(a){if(b=b||"",c=c||0,p(a))return(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a());if(n(a)){var d="";for(var e in a)d+=g(a[e],(b?b+".":"")+e,c++);return d}return(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}return""}function h(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function i(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function j(a,b,c,d){var e=b.shift(),f=void 0;if(e||(e=b.$finally.shift()),p(e))e(c,a.status,a);else if(n(e)&&(d&&e.resolve&&(f=e.resolve(c,a.status,a)),!d&&e.reject&&(f=e.reject(c,a.status,a)),f&&f.then)){if(b.forEach(function(a){f.then(a.resolve,a.reject)}),f.finally)b.$finally.forEach(function(a){f.finally(a.resolve,a.reject)});else if(b.$finally.length)throw"received promise not implements finally";e=!1}e&&j(a,b,void 0===f?c:f,d)}function k(a,b,c){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(b,c,d){a.headers[i(c)]=d.trim()});var d=a.responseText;"application/json"===a.headers.contentType?d=JSON.parse(d):"application/xml"===a.headers.contentType&&(d=(new DOMParser).parseFromString(d,"text/xml")),c[a.status]?c[a.status].apply(a,[d,function(c){j(a,b,c,!0)},function(c){j(a,b,c,!0)}]):a.status>=200&&a.status<300?(a.$resolved=!0,j(a,b,d,!0)):j(a,b,d,!1)}function l(a){this.url=a}function m(a,b){if(a=o(a)?f.apply(null,a):a,n(a)&&(b=a,a=b.url),void 0===b)return new l(a);var i,j=e(d(c(m.defaults),b)),r={},s=[];if(!a)throw"url missing";/^get$/.test(j.method)&&n(j.data)&&Object.keys(j.data).length&&(console.log("options.data",j.data),a+="?"+g(j.data),j.data=null);var t=null;try{t=new XMLHttpRequest}catch(u){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(u){t=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===t)throw"Browser does not support HTTP Request";t.open(j.method.toUpperCase(),a,void 0===j.async?!0:j.async);for(i in j.headers)t.setRequestHeader(h(i),j.headers[i]);return t.onreadystatechange=function(){("complete"===t.readyState||4===t.readyState)&&k(t,s,r)},void 0===j.data||q(j.data)||(j.data=JSON.stringify(j.data)),t.send(j.data),t.then=function(a,b){return p(a)&&s.push({resolve:a,reject:b}),t},t.catch=function(a){return p(a)&&s.push({resolve:null,reject:a}),t},s.$finally=[],t.finally=function(a){return s.$finally.push(a),t},t}var n=a("object"),o=b(Array),p=b(Function),q=a("string");return["get","head","options","post","put","delete","patch"].forEach(function(a){l.prototype[a]=function(){var b=[this.url];return[].push.apply(b,arguments),m[a].apply(null,b)}}),m.defaults={method:"get",headers:{contentType:"application/json"}},["get","head","options","post","put","delete"].forEach(function(a){m[a]=function(b,c,d){return b=o(b)?f.apply(null,b):b,n(b)&&(d=b,b=d.url),d=d||{},d.data=c,d.method=a,m(b,d)}}),m.patch=function(a,b,c){if(a=o(a)?f.apply(null,a):a,n(a))return a.method="patch",m(a);if(q(a)){if(c=n(c)?c:{},b)return m(a,d(c,{method:"patch",data:b}));var e=[],g=function(a){return e.push(a),h},h={add:function(a,b){return g({op:"add",path:a,value:b})},test:function(a,b){return g({op:"test",path:a,value:b})},replace:function(a,b){return g({op:"replace",path:a,value:b})},move:function(a,b){return g({op:"move",from:a,path:b})},copy:function(a,b){return g({op:"copy",from:a,path:b})},remove:function(a){return g({op:"remove",path:a})},flush:function(){return e.splice(0,e.length),h},submit:function(b){return b=b||e,m(a,d(c,{method:"patch",data:b}))}};return h}},m});