/*! jstool-http 2015-01-26 */
!function(a){"use strict";if("undefined"!=typeof window){if("undefined"==typeof Promise)throw"Promise is required for http to be defined";window.fn?fn.define("http",a):"undefined"!=typeof Promise&&(window.http=a())}}(function(){"use strict";function a(){for(var a,b=[],c=b.shift.call(arguments),d=b.shift.call(arguments);d;){for(a in d)c[a]=d[a];d=b.shift.call(arguments)}return c}function b(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function c(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function d(a,b,c,d){for(var e=0,f=a.length;f>e;e++)a[e].apply(d,[b,c,d])}function e(a,b,e,f,g){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\n]+)\s*\n/g,function(b,d,e){a.headers[c(d)]=e});var h=a.responseText;"application/json"===a.headers.contentType&&(h=JSON.parse(h)),g[a.status]?g[a.status].apply(a,[h,e,f]):a.status>=200&&a.status<300?(d(b.success,h,a.status,a),d(b.always,h,a.status,a),e(h)):(d(b.error,h,a.status,a),d(b.always,h,a.status,a),f(h))}function f(c,d){c instanceof Object&&(d=c,c=d.url),d=d||{};var g,h=a({},f.defaults),i={success:[],error:[],always:[]};for(g in d)d[g]instanceof Function&&(d[g]=d[g]()),h[g]instanceof Function&&(h[g]=h[g]()),"data"!==g&&d[g]instanceof Object?a(h[g],d[g]):h[g]=d[g];if(!c)throw"url missing";var j=null;try{j=new XMLHttpRequest}catch(k){try{j=new ActiveXObject("Msxml2.XMLHTTP")}catch(k){j=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===j)throw"Browser does not support HTTP Request";var l={},m=new Promise(function(a,d){j.open(h.method,c,void 0===h.async?!0:h.async);for(g in h.headers)j.setRequestHeader(b(g),h.headers[g]);j.onreadystatechange=function(){("complete"===j.readyState||4===j.readyState)&&e(j,i,a,d,l)},void 0!==h.data&&typeof h.data!==string&&(h.data=JSON.stringify(h.data)),j.send(h.data)});return m.request=j,m.success=m.done=function(a){i.success.push(a)},m.error=m.fail=function(a){i.error.push(a)},m.complete=m.always=function(a){i.always.push(a)},m.catchResponse=function(a,b){a&&b instanceof Function&&(l[a]=b)},m}return f.defaults={method:"get",headers:{contentType:"application/json"}},f.get=f,["head","options","post","patch","put","delete"].forEach(function(a){f[a]=function(b,c,d){return b instanceof Object&&(d=b,b=d.url),d=d||{},d.data=c,d.method=a.toUpperCase(),f(b,d)}}),f});